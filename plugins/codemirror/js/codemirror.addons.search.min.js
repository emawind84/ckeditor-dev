(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(b){function c(d,h,e){var g=d.getWrapperElement();var f;f=g.appendChild(document.createElement("div"));if(e){f.className="CodeMirror-dialog CodeMirror-dialog-bottom"}else{f.className="CodeMirror-dialog CodeMirror-dialog-top"}if(typeof h=="string"){f.innerHTML=h}else{f.appendChild(h)}return f}function a(d,e){if(d.state.currentNotificationClose){d.state.currentNotificationClose()}d.state.currentNotificationClose=e}b.defineExtension("openDialog",function(i,j,l){if(!l){l={}}a(this,null);var f=c(this,i,l.bottom);var e=false,g=this;function k(m){if(typeof m=="string"){h.value=m}else{if(e){return}e=true;f.parentNode.removeChild(f);g.focus();if(l.onClose){l.onClose(f)}}}var h=f.getElementsByTagName("input")[0],d;if(h){if(l.value){h.value=l.value;h.select()}if(l.onInput){b.on(h,"input",function(m){l.onInput(m,h.value,k)})}if(l.onKeyUp){b.on(h,"keyup",function(m){l.onKeyUp(m,h.value,k)})}b.on(h,"keydown",function(m){if(l&&l.onKeyDown&&l.onKeyDown(m,h.value,k)){return}if(m.keyCode==27||(l.closeOnEnter!==false&&m.keyCode==13)){h.blur();b.e_stop(m);k()}if(m.keyCode==13){j(h.value,m)}});if(l.closeOnBlur!==false){b.on(h,"blur",k)}h.focus()}else{if(d=f.getElementsByTagName("button")[0]){b.on(d,"click",function(){k();g.focus()});if(l.closeOnBlur!==false){b.on(d,"blur",k)}d.focus()}}return k});b.defineExtension("openConfirm",function(m,g,o){a(this,null);var h=c(this,m,o&&o.bottom);var j=h.getElementsByTagName("button");var f=false,k=this,d=1;function n(){if(f){return}f=true;h.parentNode.removeChild(h);k.focus()}j[0].focus();for(var e=0;e<j.length;++e){var l=j[e];(function(i){b.on(l,"click",function(p){b.e_preventDefault(p);n();if(i){i(k)}})})(g[e]);b.on(l,"blur",function(){--d;setTimeout(function(){if(d<=0){n()}},200)});b.on(l,"focus",function(){++d})}});b.defineExtension("openNotification",function(g,e){a(this,j);var f=c(this,g,e&&e.bottom);var d=false,h;var i=e&&typeof e.duration!=="undefined"?e.duration:5000;function j(){if(d){return}d=true;clearTimeout(h);f.parentNode.removeChild(f)}b.on(f,"click",function(k){b.e_preventDefault(k);j()});if(i){h=setTimeout(j,i)}return j})});(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"),require("./searchcursor"),require("../dialog/dialog"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","./searchcursor","../dialog/dialog"],a)}else{a(CodeMirror)}}})(function(e){function a(s,r){if(typeof s=="string"){s=new RegExp(s.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),r?"gi":"g")}else{if(!s.global){s=new RegExp(s.source,s.ignoreCase?"gi":"g")}}return{token:function(u){s.lastIndex=u.pos;var t=s.exec(u.string);if(t&&t.index==u.pos){u.pos+=t[0].length;return"searching"}else{if(t){u.pos=t.index}else{u.skipToEnd()}}}}}function m(){this.posFrom=this.posTo=this.query=null;this.overlay=null}function h(r){return r.state.search||(r.state.search=new m())}function q(r){return typeof r=="string"&&r==r.toLowerCase()}function o(r,s,t){return r.getSearchCursor(s,t,q(s))}function l(r,u,s,v,t){if(r.openDialog){r.openDialog(u,t,{value:v})}else{t(prompt(s,v))}}function p(s,u,t,r){if(s.openConfirm){s.openConfirm(u,r)}else{if(confirm(t)){r[0]()}}}function d(s){var r=s.match(/^\/(.*)\/([a-z]*)$/);if(r){try{s=new RegExp(r[1],r[2].indexOf("i")==-1?"":"i")}catch(t){}}if(typeof s=="string"?s=="":s.test("")){s=/x^/}return s}var c='Search: <input type="text" style="width: 10em" class="CodeMirror-search-field"/> <span style="color: #888" class="CodeMirror-search-hint">(Use /re/ syntax for regexp search)</span>';function k(r,s){var t=h(r);if(t.query){return i(r,s)}l(r,c,"Search for:",r.getSelection(),function(u){r.operation(function(){if(!u||t.query){return}t.query=d(u);r.removeOverlay(t.overlay,q(t.query));t.overlay=a(t.query,q(t.query));r.addOverlay(t.overlay);if(r.showMatchesOnScrollbar){if(t.annotate){t.annotate.clear();t.annotate=null}t.annotate=r.showMatchesOnScrollbar(t.query,q(t.query))}t.posFrom=t.posTo=r.getCursor();i(r,s)})})}function i(r,s){r.operation(function(){var t=h(r);var u=o(r,t.query,s?t.posFrom:t.posTo);if(!u.find(s)){u=o(r,t.query,s?e.Pos(r.lastLine()):e.Pos(r.firstLine(),0));if(!u.find(s)){return}}r.setSelection(u.from(),u.to());r.scrollIntoView({from:u.from(),to:u.to()});t.posFrom=u.from();t.posTo=u.to()})}function n(r){r.operation(function(){var s=h(r);if(!s.query){return}s.query=null;r.removeOverlay(s.overlay);if(s.annotate){s.annotate.clear();s.annotate=null}})}var g='Replace: <input type="text" style="width: 10em" class="CodeMirror-search-field"/> <span style="color: #888" class="CodeMirror-search-hint">(Use /re/ syntax for regexp search)</span>';var j='With: <input type="text" style="width: 10em" class="CodeMirror-search-field"/>';var f="Replace? <button>Yes</button> <button>No</button> <button>Stop</button>";function b(r,s){if(r.getOption("readOnly")){return}l(r,g,"Replace:",r.getSelection(),function(t){if(!t){return}t=d(t);l(r,j,"Replace with:","",function(x){if(s){r.operation(function(){for(var z=o(r,t);z.findNext();){if(typeof t!="string"){var y=r.getRange(z.from(),z.to()).match(t);z.replace(x.replace(/\$(\d)/g,function(A,B){return y[B]}))}else{z.replace(x)}}})}else{n(r);var w=o(r,t,r.getCursor());var v=function(){var z=w.from(),y;if(!(y=w.findNext())){w=o(r,t);if(!(y=w.findNext())||(z&&w.from().line==z.line&&w.from().ch==z.ch)){return}}r.setSelection(w.from(),w.to());r.scrollIntoView({from:w.from(),to:w.to()});p(r,f,"Replace?",[function(){u(y)},v])};var u=function(y){w.replace(typeof t=="string"?x:x.replace(/\$(\d)/g,function(z,A){return y[A]}));v()};v()}})})}e.commands.find=function(r){n(r);k(r)};e.commands.findNext=k;e.commands.findPrev=function(r){k(r,true)};e.commands.clearSearch=n;e.commands.replace=b;e.commands.replaceAll=function(r){b(r,true)}});(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(a){var b=a.Pos;function c(k,i,l,g){this.atOccurrence=false;this.doc=k;if(g==null&&typeof i=="string"){g=false}l=l?k.clipPos(l):b(0,0);this.pos={from:l,to:l};if(typeof i!="string"){if(!i.global){i=new RegExp(i.source,i.ignoreCase?"ig":"g")}this.matches=function(p,t){if(p){i.lastIndex=0;var m=k.getLine(t.line).slice(0,t.ch),r=0,o,s;for(;;){i.lastIndex=r;var q=i.exec(m);if(!q){break}o=q;s=o.index;r=o.index+(o[0].length||1);if(r==m.length){break}}var n=(o&&o[0].length)||0;if(!n){if(s==0&&m.length==0){o=undefined}else{if(s!=k.getLine(t.line).length){n++}}}}else{i.lastIndex=t.ch;var m=k.getLine(t.line),o=i.exec(m);var n=(o&&o[0].length)||0;var s=o&&o.index;if(s+n!=m.length&&!n){n=1}}if(o&&n){return{from:b(t.line,s),to:b(t.line,s+n),match:o}}}}else{var e=i;if(g){i=i.toLowerCase()}var f=g?function(m){return m.toLowerCase()}:function(m){return m};var j=i.split("\n");if(j.length==1){if(!i.length){this.matches=function(){}}else{this.matches=function(o,q){if(o){var p=k.getLine(q.line).slice(0,q.ch),m=f(p);var n=m.lastIndexOf(i);if(n>-1){n=d(p,m,n);return{from:b(q.line,n),to:b(q.line,n+e.length)}}}else{var p=k.getLine(q.line).slice(q.ch),m=f(p);var n=m.indexOf(i);if(n>-1){n=d(p,m,n)+q.ch;return{from:b(q.line,n),to:b(q.line,n+e.length)}}}}}}else{var h=e.split("\n");this.matches=function(n,p){var t=j.length-1;if(n){if(p.line-(j.length-1)<k.firstLine()){return}if(f(k.getLine(p.line).slice(0,h[t].length))!=j[j.length-1]){return}var s=b(p.line,h[t].length);for(var o=p.line-1,m=t-1;m>=1;--m,--o){if(j[m]!=f(k.getLine(o))){return}}var u=k.getLine(o),q=u.length-h[0].length;if(f(u.slice(q))!=j[0]){return}return{from:b(o,q),to:s}}else{if(p.line+(j.length-1)>k.lastLine()){return}var u=k.getLine(p.line),q=u.length-h[0].length;if(f(u.slice(q))!=j[0]){return}var r=b(p.line,q);for(var o=p.line+1,m=1;m<t;++m,++o){if(j[m]!=f(k.getLine(o))){return}}if(f(k.getLine(o).slice(0,h[t].length))!=j[t]){return}return{from:r,to:b(o,h[t].length)}}}}}}c.prototype={findNext:function(){return this.find(false)},findPrevious:function(){return this.find(true)},find:function(f){var e=this,i=this.doc.clipPos(f?this.pos.from:this.pos.to);function g(j){var k=b(j,0);e.pos={from:k,to:k};e.atOccurrence=false;return false}for(;;){if(this.pos=this.matches(f,i)){this.atOccurrence=true;return this.pos.match||true}if(f){if(!i.line){return g(0)}i=b(i.line-1,this.doc.getLine(i.line-1).length)}else{var h=this.doc.lineCount();if(i.line==h-1){return g(h)}i=b(i.line+1,0)}}},from:function(){if(this.atOccurrence){return this.pos.from}},to:function(){if(this.atOccurrence){return this.pos.to}},replace:function(f){if(!this.atOccurrence){return}var e=a.splitLines(f);this.doc.replaceRange(e,this.pos.from,this.pos.to);this.pos.to=b(this.pos.from.line+e.length-1,e[e.length-1].length+(e.length==1?this.pos.from.ch:0))}};function d(i,g,h){if(i.length==g.length){return h}for(var f=Math.min(h,i.length);;){var e=i.slice(0,f).toLowerCase().length;if(e<h){++f}else{if(e>h){--f}else{return f}}}}a.defineExtension("getSearchCursor",function(f,g,e){return new c(this.doc,f,g,e)});a.defineDocExtension("getSearchCursor",function(f,g,e){return new c(this,f,g,e)});a.defineExtension("selectMatches",function(h,g){var e=[],f;var i=this.getSearchCursor(h,this.getCursor("from"),g);while(f=i.findNext()){if(a.cmpPos(i.to(),this.getCursor("to"))>0){break}e.push({anchor:i.from(),head:i.to()})}if(e.length){this.setSelections(e,0)}})});