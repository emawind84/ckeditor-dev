(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(b){function c(d,h,e){var g=d.getWrapperElement();var f;f=g.appendChild(document.createElement("div"));if(e){f.className="CodeMirror-dialog CodeMirror-dialog-bottom"}else{f.className="CodeMirror-dialog CodeMirror-dialog-top"}if(typeof h=="string"){f.innerHTML=h}else{f.appendChild(h)}return f}function a(d,e){if(d.state.currentNotificationClose){d.state.currentNotificationClose()}d.state.currentNotificationClose=e}b.defineExtension("openDialog",function(i,j,l){if(!l){l={}}a(this,null);var f=c(this,i,l.bottom);var e=false,g=this;function k(m){if(typeof m=="string"){h.value=m}else{if(e){return}e=true;f.parentNode.removeChild(f);g.focus();if(l.onClose){l.onClose(f)}}}var h=f.getElementsByTagName("input")[0],d;if(h){if(l.value){h.value=l.value;if(l.selectValueOnOpen!==false){h.select()}}if(l.onInput){b.on(h,"input",function(m){l.onInput(m,h.value,k)})}if(l.onKeyUp){b.on(h,"keyup",function(m){l.onKeyUp(m,h.value,k)})}b.on(h,"keydown",function(m){if(l&&l.onKeyDown&&l.onKeyDown(m,h.value,k)){return}if(m.keyCode==27||(l.closeOnEnter!==false&&m.keyCode==13)){h.blur();b.e_stop(m);k()}if(m.keyCode==13){j(h.value,m)}});if(l.closeOnBlur!==false){b.on(h,"blur",k)}h.focus()}else{if(d=f.getElementsByTagName("button")[0]){b.on(d,"click",function(){k();g.focus()});if(l.closeOnBlur!==false){b.on(d,"blur",k)}d.focus()}}return k});b.defineExtension("openConfirm",function(m,g,o){a(this,null);var h=c(this,m,o&&o.bottom);var j=h.getElementsByTagName("button");var f=false,k=this,d=1;function n(){if(f){return}f=true;h.parentNode.removeChild(h);k.focus()}j[0].focus();for(var e=0;e<j.length;++e){var l=j[e];(function(i){b.on(l,"click",function(p){b.e_preventDefault(p);n();if(i){i(k)}})})(g[e]);b.on(l,"blur",function(){--d;setTimeout(function(){if(d<=0){n()}},200)});b.on(l,"focus",function(){++d})}});b.defineExtension("openNotification",function(g,e){a(this,j);var f=c(this,g,e&&e.bottom);var d=false,h;var i=e&&typeof e.duration!=="undefined"?e.duration:5000;function j(){if(d){return}d=true;clearTimeout(h);f.parentNode.removeChild(f)}b.on(f,"click",function(k){b.e_preventDefault(k);j()});if(i){h=setTimeout(j,i)}return j})});(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"),require("./searchcursor"),require("../dialog/dialog"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","./searchcursor","../dialog/dialog"],a)}else{a(CodeMirror)}}})(function(l){function i(u,t){if(typeof u=="string"){u=new RegExp(u.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),t?"gi":"g")}else{if(!u.global){u=new RegExp(u.source,u.ignoreCase?"gi":"g")}}return{token:function(w){u.lastIndex=w.pos;var v=u.exec(w.string);if(v&&v.index==w.pos){w.pos+=v[0].length;return"searching"}else{if(v){w.pos=v.index}else{w.skipToEnd()}}}}}function h(){this.posFrom=this.posTo=this.lastQuery=this.query=null;this.overlay=null}function q(t){return t.state.search||(t.state.search=new h())}function d(t){return typeof t=="string"&&t==t.toLowerCase()}function b(t,u,v){return t.getSearchCursor(u,v,d(u))}function c(t,v,w,u){t.openDialog(v,u,{value:w,selectValueOnOpen:true,closeOnEnter:false,onClose:function(){o(t)}})}function n(t,w,u,x,v){if(t.openDialog){t.openDialog(w,v,{value:x,selectValueOnOpen:true})}else{v(prompt(u,x))}}function j(u,w,v,t){if(u.openConfirm){u.openConfirm(w,t)}else{if(confirm(v)){t[0]()}}}function g(u){var t=u.match(/^\/(.*)\/([a-z]*)$/);if(t){try{u=new RegExp(t[1],t[2].indexOf("i")==-1?"":"i")}catch(v){}}if(typeof u=="string"?u=="":u.test("")){u=/x^/}return u}var s='Search: <input type="text" style="width: 10em" class="CodeMirror-search-field"/> <span style="color: #888" class="CodeMirror-search-hint">(Use /re/ syntax for regexp search)</span>';function r(t,v,u){v.queryText=u;v.query=g(u);t.removeOverlay(v.overlay,d(v.query));v.overlay=i(v.query,d(v.query));t.addOverlay(v.overlay);if(t.showMatchesOnScrollbar){if(v.annotate){v.annotate.clear();v.annotate=null}v.annotate=t.showMatchesOnScrollbar(v.query,d(v.query))}}function k(t,v,u){var x=q(t);if(x.query){return e(t,v)}var w=t.getSelection()||x.lastQuery;if(u&&t.openDialog){c(t,s,w,function(z,y){l.e_stop(y);if(!z){return}if(z!=x.queryText){r(t,x,z)}e(t,y.shiftKey)})}else{n(t,s,"Search for:",w,function(y){if(y&&!x.query){t.operation(function(){r(t,x,y);x.posFrom=x.posTo=t.getCursor();e(t,v)})}})}}function e(t,u){t.operation(function(){var v=q(t);var w=b(t,v.query,u?v.posFrom:v.posTo);if(!w.find(u)){w=b(t,v.query,u?l.Pos(t.lastLine()):l.Pos(t.firstLine(),0));if(!w.find(u)){return}}t.setSelection(w.from(),w.to());t.scrollIntoView({from:w.from(),to:w.to()},20);v.posFrom=w.from();v.posTo=w.to()})}function o(t){t.operation(function(){var u=q(t);u.lastQuery=u.query;if(!u.query){return}u.query=u.queryText=null;t.removeOverlay(u.overlay);if(u.annotate){u.annotate.clear();u.annotate=null}})}var a='Replace: <input type="text" style="width: 10em" class="CodeMirror-search-field"/> <span style="color: #888" class="CodeMirror-search-hint">(Use /re/ syntax for regexp search)</span>';var f='With: <input type="text" style="width: 10em" class="CodeMirror-search-field"/>';var m="Replace? <button>Yes</button> <button>No</button> <button>Stop</button>";function p(t,u){if(t.getOption("readOnly")){return}var v=t.getSelection()||q(t).lastQuery;n(t,a,"Replace:",v,function(w){if(!w){return}w=g(w);n(t,f,"Replace with:","",function(A){if(u){t.operation(function(){for(var C=b(t,w);C.findNext();){if(typeof w!="string"){var B=t.getRange(C.from(),C.to()).match(w);C.replace(A.replace(/\$(\d)/g,function(D,E){return B[E]}))}else{C.replace(A)}}})}else{o(t);var z=b(t,w,t.getCursor());var y=function(){var C=z.from(),B;if(!(B=z.findNext())){z=b(t,w);if(!(B=z.findNext())||(C&&z.from().line==C.line&&z.from().ch==C.ch)){return}}t.setSelection(z.from(),z.to());t.scrollIntoView({from:z.from(),to:z.to()});j(t,m,"Replace?",[function(){x(B)},y])};var x=function(B){z.replace(typeof w=="string"?A:A.replace(/\$(\d)/g,function(C,D){return B[D]}));y()};y()}})})}l.commands.find=function(t){o(t);k(t)};l.commands.findPersistent=function(t){o(t);k(t,false,true)};l.commands.findNext=k;l.commands.findPrev=function(t){k(t,true)};l.commands.clearSearch=o;l.commands.replace=p;l.commands.replaceAll=function(t){p(t,true)}});(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(a){var b=a.Pos;function c(k,i,l,g){this.atOccurrence=false;this.doc=k;if(g==null&&typeof i=="string"){g=false}l=l?k.clipPos(l):b(0,0);this.pos={from:l,to:l};if(typeof i!="string"){if(!i.global){i=new RegExp(i.source,i.ignoreCase?"ig":"g")}this.matches=function(p,t){if(p){i.lastIndex=0;var m=k.getLine(t.line).slice(0,t.ch),r=0,o,s;for(;;){i.lastIndex=r;var q=i.exec(m);if(!q){break}o=q;s=o.index;r=o.index+(o[0].length||1);if(r==m.length){break}}var n=(o&&o[0].length)||0;if(!n){if(s==0&&m.length==0){o=undefined}else{if(s!=k.getLine(t.line).length){n++}}}}else{i.lastIndex=t.ch;var m=k.getLine(t.line),o=i.exec(m);var n=(o&&o[0].length)||0;var s=o&&o.index;if(s+n!=m.length&&!n){n=1}}if(o&&n){return{from:b(t.line,s),to:b(t.line,s+n),match:o}}}}else{var e=i;if(g){i=i.toLowerCase()}var f=g?function(m){return m.toLowerCase()}:function(m){return m};var j=i.split("\n");if(j.length==1){if(!i.length){this.matches=function(){}}else{this.matches=function(o,q){if(o){var p=k.getLine(q.line).slice(0,q.ch),m=f(p);var n=m.lastIndexOf(i);if(n>-1){n=d(p,m,n);return{from:b(q.line,n),to:b(q.line,n+e.length)}}}else{var p=k.getLine(q.line).slice(q.ch),m=f(p);var n=m.indexOf(i);if(n>-1){n=d(p,m,n)+q.ch;return{from:b(q.line,n),to:b(q.line,n+e.length)}}}}}}else{var h=e.split("\n");this.matches=function(n,p){var t=j.length-1;if(n){if(p.line-(j.length-1)<k.firstLine()){return}if(f(k.getLine(p.line).slice(0,h[t].length))!=j[j.length-1]){return}var s=b(p.line,h[t].length);for(var o=p.line-1,m=t-1;m>=1;--m,--o){if(j[m]!=f(k.getLine(o))){return}}var u=k.getLine(o),q=u.length-h[0].length;if(f(u.slice(q))!=j[0]){return}return{from:b(o,q),to:s}}else{if(p.line+(j.length-1)>k.lastLine()){return}var u=k.getLine(p.line),q=u.length-h[0].length;if(f(u.slice(q))!=j[0]){return}var r=b(p.line,q);for(var o=p.line+1,m=1;m<t;++m,++o){if(j[m]!=f(k.getLine(o))){return}}if(f(k.getLine(o).slice(0,h[t].length))!=j[t]){return}return{from:r,to:b(o,h[t].length)}}}}}}c.prototype={findNext:function(){return this.find(false)},findPrevious:function(){return this.find(true)},find:function(f){var e=this,i=this.doc.clipPos(f?this.pos.from:this.pos.to);function g(j){var k=b(j,0);e.pos={from:k,to:k};e.atOccurrence=false;return false}for(;;){if(this.pos=this.matches(f,i)){this.atOccurrence=true;return this.pos.match||true}if(f){if(!i.line){return g(0)}i=b(i.line-1,this.doc.getLine(i.line-1).length)}else{var h=this.doc.lineCount();if(i.line==h-1){return g(h)}i=b(i.line+1,0)}}},from:function(){if(this.atOccurrence){return this.pos.from}},to:function(){if(this.atOccurrence){return this.pos.to}},replace:function(g,f){if(!this.atOccurrence){return}var e=a.splitLines(g);this.doc.replaceRange(e,this.pos.from,this.pos.to,f);this.pos.to=b(this.pos.from.line+e.length-1,e[e.length-1].length+(e.length==1?this.pos.from.ch:0))}};function d(i,g,h){if(i.length==g.length){return h}for(var f=Math.min(h,i.length);;){var e=i.slice(0,f).toLowerCase().length;if(e<h){++f}else{if(e>h){--f}else{return f}}}}a.defineExtension("getSearchCursor",function(f,g,e){return new c(this.doc,f,g,e)});a.defineDocExtension("getSearchCursor",function(f,g,e){return new c(this,f,g,e)});a.defineExtension("selectMatches",function(g,f){var e=[];var h=this.getSearchCursor(g,this.getCursor("from"),f);while(h.findNext()){if(a.cmpPos(h.to(),this.getCursor("to"))>0){break}e.push({anchor:h.from(),head:h.to()})}if(e.length){this.setSelections(e,0)}})});